/**
 * Created by Administrator on 2016/11/22.
 */var drawing=document.getElementById("drawing"),ctx=drawing.getContext("2d"),fireWorkArr=[],dotArrs=[],valve=null;ctx.lineWidth=2;
function start(){fireWorkArr=[];dotArrs=[];for(var m=3*Math.random()+1,p=null,n=!0,l=[],k=0;k<m;k++)fireWorkArr[k]=new fireworks,l[k]=0,dotArrs[k]=[],function(k){fireWorkArr[k].timerF=setInterval(function(){ctx.clearRect(0,0,1600,700);for(var a=0;a<m;a++){var e=dotArrs[a];ctx.beginPath();ctx.moveTo(fireWorkArr[a].xLeader,fireWorkArr[a].yLeader);fireWorkArr[a].xLeader+=fireWorkArr[a].xStep;fireWorkArr[a].yStep+=fireWorkArr[a].yg;fireWorkArr[a].yLeader+=fireWorkArr[a].yStep;ctx.lineTo(fireWorkArr[a].xLeader,
    fireWorkArr[a].yLeader);ctx.strokeStyle="rgb("+fireWorkArr[a].R+","+fireWorkArr[a].G+","+fireWorkArr[a].B+")";ctx.closePath();ctx.stroke();if(n)e[l[a]]={x:fireWorkArr[a].xLeader,y:fireWorkArr[a].yLeader};else{for(var g=0;g<e.length-1;g++)e[g]=e[g+1];e[e.length-1]={x:fireWorkArr[a].xLeader,y:fireWorkArr[a].yLeader}}for(g=0;g<e.length-1;g++){var k=ctx.createRadialGradient(e[g+1].x,e[g+1].y,1,e[g+1].x,e[g+1].y,g/e.length*5);k.addColorStop(1,"rgba("+fireWorkArr[a].R+","+fireWorkArr[a].G+","+fireWorkArr[a].B+
    ", 0 )");k.addColorStop(0,"rgba("+fireWorkArr[a].R+","+fireWorkArr[a].G+","+fireWorkArr[a].B+","+g/e.length+")");ctx.fillStyle=k;ctx.beginPath();ctx.arc(e[g+1].x,e[g+1].y,g/e.length*5,0,2*Math.PI,!1);ctx.fill();ctx.closePath()}l[a]++;setTimeout(function(){n=!1},200);100===l[a]&&(clearTimeout(p),fireWorkArr[a].xMax=fireWorkArr[a].xLeader,fireWorkArr[a].yMax=fireWorkArr[a].yLeader,p=setTimeout(boom,10))}},15)}(k)}
function boom(){for(var m=[],p=[],n=[],l=[],k=[],r=[],a=0;a<fireWorkArr.length;a++){r[a]=dotArrs[a].length;m[a]=[];p[a]=!0;n[a]=[];clearInterval(fireWorkArr[a].timerF);ctx.closePath();ctx.clearRect(0,0,1600,700);for(var e=n[a],g=m[a],q=3*Math.random()+3,d=0;d<fireWorkArr[a].num;d++)e[d]={yg:.05,xLeader:fireWorkArr[a].xMax,yLeader:fireWorkArr[a].yMax,num:0,R:Math.ceil(255*Math.random()),G:Math.ceil(255*Math.random()),B:Math.ceil(255*Math.random())},g[d]=[];if(.5<Math.random())for(d=0;d<fireWorkArr[a].num;d++)e[d].xStep=
    .5<Math.random()?6*Math.random()-3:Math.cos(2*d*Math.PI/fireWorkArr[a].num)*q,e[d].yStep=.5<Math.random()?6*Math.random()-3:Math.sin(2*d*Math.PI/fireWorkArr[a].num)*q,l[a]=!1;else for(d=0;d<fireWorkArr[a].num;d++)e[d].xStep=Math.cos(2*d*Math.PI/fireWorkArr[a].num)*q,e[d].yStep=Math.sin(2*d*Math.PI/fireWorkArr[a].num)*q,l[a]=!0;k[a]=Math.ceil(20*Math.random())}boomTimer=setInterval(function(){ctx.clearRect(0,0,1600,700);for(var a=0;a<fireWorkArr.length;a++){var f=n[a],e=m[a],g=p[a],b=dotArrs[a];if(0!==
    b.length){for(var c=0;c<b.length-1;c++){var d=ctx.createRadialGradient(b[c+1].x,b[c+1].y,1,b[c+1].x,b[c+1].y,c/b.length*5);d.addColorStop(1,"rgba("+fireWorkArr[a].R+","+fireWorkArr[a].G+","+fireWorkArr[a].B+", 0 )");d.addColorStop(0,"rgba("+fireWorkArr[a].R+","+fireWorkArr[a].G+","+fireWorkArr[a].B+","+c/r[a]+")");ctx.fillStyle=d;ctx.beginPath();ctx.arc(b[c+1].x,b[c+1].y,c/b.length*5,0,2*Math.PI,!1);ctx.fill();ctx.closePath()}b.shift()}for(b=0;b<fireWorkArr[a].num;b++){var h=e[b];f[b].xLeader+=f[b].xStep;
    f[b].yStep+=f[b].yg;f[b].yLeader+=f[b].yStep;if(g)h[f[b].num]={x:f[b].xLeader,y:f[b].yLeader};else{for(c=0;c<h.length-1;c++)h[c]=h[c+1];h[h.length-1]={x:f[b].xLeader,y:f[b].yLeader}}for(c=0;c<h.length-1;c++)d=ctx.createRadialGradient(h[c+1].x,h[c+1].y,1,h[c+1].x,h[c+1].y,c/h.length*5),l[a]?(d.addColorStop(1,"rgba("+fireWorkArr[a].R+","+fireWorkArr[a].G+","+fireWorkArr[a].B+", 0 )"),d.addColorStop(0,"rgba("+fireWorkArr[a].R+","+fireWorkArr[a].G+","+fireWorkArr[a].B+","+c/h.length*(1-(f[b].num+k[a])/
        50)+")")):(d.addColorStop(1,"rgba("+f[b].R+","+f[b].G+","+f[b].B+", 0 )"),d.addColorStop(0,"rgba("+f[b].R+","+f[b].G+","+f[b].B+","+c/h.length*(1-(f[b].num+k[a])/50)+")")),ctx.fillStyle=d,ctx.beginPath(),ctx.arc(h[c+1].x,h[c+1].y,c/h.length*5,0,2*Math.PI,!1),ctx.fill(),ctx.closePath();setTimeout(function(){g=!1},200);f[b].num++;50===f[b].num&&(ctx.clearRect(0,0,drawing.offsetWidth,drawing.offsetHeight),clearTimeout(valve),clearInterval(boomTimer),valve=setTimeout(start,100))}}},15)}start();
function fireworks(){this.xStrat=1E3*Math.random()+300;this.yStrat=drawing.offsetHeight;this.xStep=500>this.xStrat?1.2+3.5*Math.random():-1.2-3.5*Math.random();this.yStep=-9-2*Math.random();this.yg=.1;this.xLeader=this.xStrat;this.yLeader=this.yStrat;this.R=Math.ceil(255*Math.random());this.G=Math.ceil(255*Math.random());this.B=Math.ceil(255*Math.random());this.timerF=null;this.num=10*Math.random()+20};